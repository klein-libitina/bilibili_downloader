# Bilibili视频下载器 Pro

一个功能强大的B站视频下载工具，支持账号登录、高清视频、Hi-Res音频、音视频分离下载。

## 功能特点

### 核心功能
- ✅ 简洁美观的GUI界面
- ✅ 扫码登录B站账号
- ✅ **智能保持登录** - IP未变化时自动恢复登录状态
- ✅ 获取视频详细信息
- ✅ 实时下载进度显示

### 高级功能
- 🎬 **多种清晰度支持**
  - 8K超高清
  - 4K超清
  - 杜比视界
  - HDR真彩
  - 1080P 60帧/高码率
  - 720P 60帧
  - 720P/480P/360P标清

- 🎵 **Hi-Res音频支持**
  - Hi-Res无损音质 ⭐
  - 320K极高音质
  - 128K高清音质
  - 64K流畅音质

- 📦 **灵活下载选项**
  - 视频+音频合并下载
  - 仅下载视频
  - 仅下载音频

- 🎞️ **多格式输出**
  - **视频格式**: MP4（推荐）、FLV
  - **音频格式**: MP3、FLAC（无损）、WAV（无损）、M4A、AAC
  - 💡 **智能格式推荐**: 选择Hi-Res音频时自动推荐FLAC格式

## 系统要求

- Python 3.7+
- Windows/Linux/MacOS
- **ffmpeg** (必须安装，用于音视频合并和格式转换)

### 安装ffmpeg

**Windows:**
1. 下载: https://ffmpeg.org/download.html
2. 解压并将bin目录添加到系统PATH
3. 验证: 在命令行输入 `ffmpeg -version`

**MacOS:**
```bash
brew install ffmpeg
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt update
sudo apt install ffmpeg
```

## 安装依赖

```bash
cd bilibili_downloader
pip install -r requirements.txt
```

## 使用方法

### 1. 启动程序

```bash
python main.py
```

### 2. 登录账号（可选）

- 点击"扫码登录"按钮
- 使用B站APP扫描二维码
- 登录后可下载高清内容和Hi-Res音频

> **智能保持登录**：
> - 登录成功后，程序会自动保存登录状态
> - 下次启动时，如果IP地址未变化，将自动恢复登录
> - 登录状态最长保持30天
> - 可以随时点击"退出登录"按钮清除登录状态

> **提示**: 未登录最高支持720P，登录后可下载4K/8K等高清内容

### 3. 获取视频信息

- 在"视频地址"框中输入B站视频URL
  - 示例：`https://www.bilibili.com/video/BV1xx411c7mD`
- 点击"获取视频信息"
- 程序会自动获取可用的清晰度和音质选项

### 4. 选择下载选项

**下载类型:**
- **视频+音频(合并)**: 下载完整视频（推荐）
- **仅视频**: 只下载视频流（无声音）
- **仅音频**: 只下载音频（可用于提取BGM）

**视频清晰度:**
- 选择列表中的清晰度，支持2K/4K/8K等高清选项
- 分辨率信息会显示在括号中

**音频质量:**
- Hi-Res无损 ⭐ (需登录，最高音质)
- 320K极高 (高品质)
- 128K高清 (标准)
- 64K流畅 (节省空间)

**输出格式:**

*视频格式（用于视频或合并下载）:*
- **MP4**: 最通用，所有设备支持（推荐）
- **FLV**: B站原始格式

*音频格式（用于仅音频下载）:*
- **MP3**: 通用格式，兼容性好
- **FLAC**: 无损格式，保留完整音质（推荐Hi-Res）
- **WAV**: 无损格式，无压缩
- **M4A**: 苹果设备友好
- **AAC**: 高效压缩格式

> 💡 **智能提示**: 当选择Hi-Res无损音频时，程序会自动推荐FLAC格式以保留最佳音质

### 5. 开始下载

- 点击"开始下载"按钮
- 选择保存位置
- 等待下载完成

## 依赖包

- `requests`: HTTP请求库
- `Pillow`: 图像处理库
- `qrcode`: 二维码生成库
- `ffmpeg-python`: FFmpeg Python封装

## 文件结构

```
bilibili_downloader/
├── main.py              # 主程序入口
├── gui.py               # GUI界面（支持高级功能）
├── bilibili_api.py      # B站API封装（音视频分离、多清晰度）
├── requirements.txt     # 依赖包列表
└── README.md           # 说明文档
```

## 使用示例

### 下载4K视频
1. 登录账号
2. 输入视频URL
3. 获取视频信息
4. 选择"4K超清"
5. 选择"Hi-Res无损"音频
6. 选择"MP4"格式
7. 开始下载

### 仅下载Hi-Res无损音频
1. 登录账号
2. 输入视频URL
3. 获取视频信息
4. 选择"仅音频"
5. 选择"Hi-Res无损"音频（会自动推荐FLAC格式）
6. 格式已自动选择为"FLAC"
7. 开始下载

### 下载MP3音频（提取BGM）
1. 输入视频URL
2. 获取视频信息
3. 选择"仅音频"
4. 选择音频质量（推荐"320K极高"）
5. 选择"MP3"格式
6. 开始下载

### 下载1080P 60帧视频
1. 输入视频URL
2. 获取视频信息
3. 选择"1080P 60帧"
4. 选择"320K极高"音频
5. 选择"MP4"格式
6. 开始下载

## 常见问题

### Q: 为什么某些清晰度不可用？
A: 部分高清内容（1080P+、4K、Hi-Res音频）需要登录账号才能下载。

### Q: ffmpeg未找到怎么办？
A: 请确保已安装ffmpeg并添加到系统PATH。Windows用户可以将ffmpeg.exe放在程序目录下。

### Q: 下载速度慢怎么办？
A: 下载速度取决于网络状况和B站服务器。建议避开高峰时段。

### Q: 可以下载番剧/电影吗？
A: 仅支持普通视频，付费内容和有版权保护的视频无法下载。

### Q: 音视频不同步怎么办？
A: 确保ffmpeg版本为最新，程序会自动处理同步问题。

### Q: 应该选择哪种音频格式？
A:
- **Hi-Res无损音质 → FLAC/WAV**: 保留完整音质，文件较大（程序会自动推荐FLAC）
- **普通音质 → MP3**: 通用格式，兼容性最好
- **苹果设备 → M4A**: iTunes和iPhone最佳
- **高效压缩 → AAC**: 文件小，音质好

### Q: 保持登录功能如何工作？
A:
- 登录成功后，程序会加密保存登录凭证和IP地址
- 下次启动时自动检查IP是否变化
- 如果IP未变且凭证有效（30天内），自动恢复登录
- 更换网络或IP变化后需要重新登录
- 可以手动点击"退出登录"清除保存的登录状态

### Q: 登录状态文件保存在哪里？
A: 登录状态保存在程序目录的 `.bili_login.json` 文件中，该文件包含敏感信息，不会被git追踪。

## 技术特性

- **DASH流媒体**: 支持音视频分离的DASH格式
- **多线程下载**: 使用多线程提高下载效率
- **智能合并**: 自动使用ffmpeg合并音视频
- **多格式转换**: 支持MP3、FLAC、WAV、M4A、AAC等多种音频格式转换
- **智能格式推荐**: 选择Hi-Res音频时自动推荐FLAC无损格式
- **智能保持登录**: 基于IP验证的登录状态持久化（30天有效期）
- **错误处理**: 完善的异常捕获和提示

## 注意事项

⚠️ **重要提示**:
- 下载的视频仅供个人学习使用，请勿传播
- 尊重UP主版权，支持正版
- 部分视频可能因版权限制无法下载
- 请勿用于商业用途

## 更新日志

### v2.2 (最新)
- ✨ 新增智能保持登录功能
- ✨ 基于IP地址的自动登录验证
- ✨ 登录状态持久化（30天有效期）
- ✨ 添加退出登录功能
- 🔒 登录凭证本地加密存储

### v2.1
- ✨ 新增多种音频格式支持（MP3、FLAC、WAV、AAC）
- ✨ 智能格式推荐：选择Hi-Res音频时自动推荐FLAC格式
- ✨ 动态格式选择：根据下载类型显示相应格式选项
- ✨ 优化音频转换质量参数
- 🎨 改进界面布局和提示信息

### v2.0 (Pro版本)
- ✨ 新增音视频分离下载
- ✨ 支持2K/4K/8K高清视频
- ✨ 支持Hi-Res无损音频
- ✨ 新增多格式输出(MP4/FLV/M4A)
- ✨ 改进UI界面和用户体验
- ✨ 添加ffmpeg自动合并功能

### v1.0
- 基础视频下载功能
- 扫码登录支持
- 多清晰度选择

---

**祝您使用愉快！如有问题请提Issue。**

